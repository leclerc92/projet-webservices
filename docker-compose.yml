services:
  # ==========================================
  # Service REST - Vérification d'identité
  # ==========================================
  rest-identity-service:
    build:
      context: ./RESTIdentityService
      dockerfile: Dockerfile
    container_name: rest-identity-service
    ports:
      - "8080:8080"
    networks:
      - insurance-network

  # ==========================================
  # Service SOAP - Gestion des polices
  # ==========================================
  soap-policy-service:
    build:
      context: ./SOAPPolicySercice
      dockerfile: Dockerfile
    container_name: soap-policy-service
    ports:
      - "8081:8081"
    networks:
      - insurance-network

  # ==========================================
  # Service GraphQL - Suivi des réclamations
  # ==========================================
  graphql-claim-service:
    build:
      context: ./GraphQLClaimTrackingService
      dockerfile: Dockerfile
    container_name: graphql-claim-service
    ports:
      - "4000:4000"
    networks:
      - insurance-network
    depends_on:
      - mongo

  # ==========================================
  # Service MongoDB - Base de données pour GraphQL
  # ==========================================
  mongo:
    image: mongo:latest
    container_name: mongo
    ports:
      - "27017:27017"
    volumes:
      - mongo-data:/data/db
    networks:
      - insurance-network

  # ==========================================
  # Service gRPC - Détection de fraude
  # ==========================================
  grpc-fraud-service:
    build:
      context: ./gRPCFraudDetectionService
      dockerfile: Dockerfile
    container_name: grpc-fraud-service
    ports:
      - "50051:50051"
    networks:
      - insurance-network

  # ==========================================
  # Service Workflow - Orchestrateur principal
  # ==========================================
  workflow-service:
    build:
      context: ./WorkflowService
      dockerfile: Dockerfile
    container_name: workflow-service
    ports:
      - "8082:8082"
    environment:
      # Configuration des URLs des services
      - REST_IDENTITY_SERVICE_URL=http://rest-identity-service:8080/api/identity
      - SOAP_POLICY_SERVICE_URL=http://soap-policy-service:8081/ws
      - GRAPHQL_CLAIM_SERVICE_URL=http://graphql-claim-service:4000
      - GRPC_FRAUD_SERVICE_HOST=grpc-fraud-service
      - GRPC_FRAUD_SERVICE_PORT=50051
    depends_on:
      - rest-identity-service
      - soap-policy-service
      - graphql-claim-service
      - grpc-fraud-service
    networks:
      - insurance-network

  # ==========================================
  # Frontend - Interface utilisateur
  # ==========================================
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: frontend
    ports:
      - "3000:80"
    depends_on:
      - workflow-service
    networks:
      - insurance-network

volumes:
  mongo-data:

networks:
  insurance-network:
    driver: bridge
