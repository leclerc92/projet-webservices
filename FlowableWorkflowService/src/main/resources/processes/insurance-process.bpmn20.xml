<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xmlns:flowable="http://flowable.org/bpmn"
             targetNamespace="http://www.flowable.org/processdef">

    <process id="insuranceClaimProcess" name="Insurance Claim Process" isExecutable="true">

        <startEvent id="startEvent" />
        <sequenceFlow sourceRef="startEvent" targetRef="verifyIdentityTask" />

        <serviceTask id="verifyIdentityTask" name="Vérifier Identité (REST)"
                     flowable:delegateExpression="${verifyIdentityDelegate}" />
        <sequenceFlow sourceRef="verifyIdentityTask" targetRef="identityDecisionGateway" />

        <exclusiveGateway id="identityDecisionGateway" name="Identité Valide ?" />

        <sequenceFlow sourceRef="identityDecisionGateway" targetRef="checkPolicyTask">
            <conditionExpression xsi:type="tFormalExpression">
                <![CDATA[${isIdentityValid == true}]]>
            </conditionExpression>
        </sequenceFlow>

        <sequenceFlow sourceRef="identityDecisionGateway" targetRef="rejectionEndEvent">
            <conditionExpression xsi:type="tFormalExpression">
                <![CDATA[${isIdentityValid == false}]]>
            </conditionExpression>
        </sequenceFlow>

        <serviceTask id="checkPolicyTask" name="Vérifier Police (SOAP)"
                     flowable:delegateExpression="${checkPolicyDelegate}" />
        <sequenceFlow sourceRef="checkPolicyTask" targetRef="approvedEndEvent" />

        <endEvent id="approvedEndEvent" name="Dossier en cours" />
        <endEvent id="rejectionEndEvent" name="Rejeté (Fraude Identité)" />

    </process>

</definitions>